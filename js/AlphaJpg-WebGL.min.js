var AlphaJpg_WebGL=function(){var e=null,r=null,t=function(){var t=arguments.length>0&&!!arguments[0];return function(){if(null!==e)return e;var r=document.createElement("CANVAS"),t=r.getContext("webgl")||r.getContext("experimental-webgl");return e=!!(t&&t instanceof WebGLRenderingContext)}()&&(!t||t&&function(){if(null!==r)return r;var e=document.createElement("CANVAS");return e.width=e.height=1,r="function"==typeof e.toDataURL&&0===e.toDataURL().indexOf("data:")}())},a=function(e){var r=window.location;try{return new URL(e).origin===r.origin}catch(n){var t,a,o=document.createElement("A");return o.href=e,document.head.appendChild(o),o.href=o.href,t=(o.protocol+"//"+o.host).replace(/:\d+/,"").toLowerCase(),a=(r.protocol+"//"+r.host).replace(/:\d+/,"").toLowerCase(),document.head.removeChild(o),t===a}},o=function(e,r,t){var a,o,n,i,c,u,T,g=document.createElement("CANVAS"),l=g.getContext("webgl")||g.getContext("experimental-webgl"),m=e.naturalWidth,E=e.naturalHeight,d=Math.floor(E/2);return g.width=m,g.height=d,a=l.createShader(l.VERTEX_SHADER),l.shaderSource(a,"attribute vec2 aPos;attribute vec2 aTex;uniform vec2 uRes;varying vec2 vTex;void main() {vec2 clipSpace = (((aPos / uRes) * 2.0) - 1.0) * vec2(1, -1);gl_Position = vec4(clipSpace, 0, 1);vTex = aTex;}"),l.compileShader(a),l.getShaderParameter(a,l.COMPILE_STATUS)?(o=l.createShader(l.FRAGMENT_SHADER),l.shaderSource(o,"precision mediump float;uniform sampler2D uImg;varying vec2 vTex;void main() {vec4 img = texture2D(uImg, vTex);vec4 mask = texture2D(uImg, vec2(vTex.x, vTex.y + 0.5));vec4 o = vec4(img.r * mask.r, img.g * mask.r, img.b * mask.r, mask.r);gl_FragColor = vec4(o.rgb / o.a, o.a);}"),l.compileShader(o),l.getShaderParameter(o,l.COMPILE_STATUS)?(n=l.createProgram(),l.attachShader(n,a),l.attachShader(n,o),l.linkProgram(n),l.getProgramParameter(n,l.LINK_STATUS)?(u=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,u),l.bufferData(l.ARRAY_BUFFER,new Float32Array([0,0,m,0,0,E,0,E,m,0,m,E]),l.STATIC_DRAW),i=l.getAttribLocation(n,"aPos"),l.enableVertexAttribArray(i),l.vertexAttribPointer(i,2,l.FLOAT,!1,0,0),T=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,T),l.bufferData(l.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),l.STATIC_DRAW),c=l.getAttribLocation(n,"aTex"),l.enableVertexAttribArray(c),l.vertexAttribPointer(c,2,l.FLOAT,!1,0,0),l.bindTexture(l.TEXTURE_2D,l.createTexture()),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.NEAREST),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,l.NEAREST),l.texImage2D(l.TEXTURE_2D,0,l.RGB,l.RGB,l.UNSIGNED_BYTE,e),l.viewport(0,0,m,d),l.useProgram(n),l.uniform2f(l.getUniformLocation(n,"uRes"),m,d),l.drawArrays(l.TRIANGLES,0,6),r(t?g.toDataURL():g),!0):(console.error(l.getProgramInfoLog(n)),l.deleteProgram(n),!1)):(console.error(l.getShaderInfoLog(o)),l.deleteShader(o),!1)):(console.error(l.getShaderInfoLog(a)),l.deleteShader(a),!1)};return{isSupported:t,load:function(e,r){var n,i=arguments.length>2&&!!arguments[2];"string"==typeof e&&"function"==typeof r&&t(i)?((n=new Image).onload=function(){o(n,r,i)},n.onerror=function(){r(!1)},a(e)||(n.crossOrigin=""),n.src=e):r(!1)}}}();
